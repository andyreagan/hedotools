// namespace it
// begin with some helper functions
// http://stackoverflow.com/a/1026087/3780153
// this works really well, but it's deadly slow (working max 5 elements)
// and it's coupled to jquery
// http://stackoverflow.com/a/5047712/3780153
// yup
// http://stackoverflow.com/questions/3883342/add-commas-to-a-number-in-jquery
// look away
// make the plot
// on call as a module
// in the test function, can set the function that gets called
// when the lens is moved
// full flexibility
// current usage example:
// (from the sankey page)
//
// hedotools.shifter.shift(allDataOld[hedotools.sankey.newindices()[0]].freq,allDatra[hedotools.sankey.newindices()[0]].freq,lens,words);
// hedotools.shifter.setfigure(d3.select("#shift01")).setHeight(400).setText("Why "+allDataOld[hedotools.sankey.newindices()[0]].name+" has become "+"happier"+":").plot();
//
// there are two options for having it compute the shift
// calling the .shift() with four arguments does the trick
// or calling .shifter() with no arguments also does 
// for the latter, need to have defined the variables beforehand
// using the _lens, _words, etc accessors
//
// if the text isn't set, will attempt to grab it using the
// allData structure (which works in the maps.html)
//
// the text setting here removes all p instances in the figure,
// and then inserts a new one before the svg, inside the figure (using d3.insert)
//
// can also use the setText method to set the text
// define the shifter module 
// my_array = Array(10000);
// for (var i=0; i<my_array.length; i++) { my_array[i] = i; }
function capitaliseFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)}function commaSeparateNumber(t){for(;/(\d+)(\d{3})/.test(t.toString());)t=t.toString().replace(/(\d+)(\d{3})/,"$1,$2")
return t}function splitWidth(t,e){for(var r=t.split(" "),n=[r[0]],a=1,o=0;a<r.length;)(n[o]+r[a]).width()<e?n[o]+=" "+r[a]:(o++,n.push(r[a])),a++
return n}function cloudSpriteSimple(t,e,r){if(!e.sprite){t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,r[0],r[1]),t.save()
t.font=e.fontString,t.textAlign="center",t.textBaseline="bottom",t.fillStyle="red",t.strokeStyle="red",t.textAlign="center",t.lineWidth=2*e.padding
var n=t.measureText(e.text+"m").width,a=e.size
e.x0=Math.floor(-n/2),e.x1=Math.ceil(n/2),e.y0=0,e.y1=Math.ceil(a),t.translate(r[0]/2,r[1]/2),t.rotate(e.rotate*cloudRadians),t.fillText(e.text,0,0),t.strokeText(e.text,0,0)
var o=t.getImageData(r[0]/2+e.x0,r[1]/2+e.y0-e.y1,2*e.x1,e.y1).data
e.sprite=monochrome(o),t.restore()}}function monochrome(t){for(var e=Array(t.length/4),r=0;r<e.length;r++){var n=t[4*r]
e[r]=n>25.6?1:0}return e}function collideRects(t,e){return e.x0<t.x1&&e.x1>t.x0&&e.y1>t.y0&&e.y0>t.y1}function indexer2d(t,e,r,n,a,o){for(var s=Array((n-r+1)*(o-a+1)),i=r;i<=n;i++)for(var l=a;l<=o;l++)s[(i-r)*(o-a+1)+(l-a)]=t[e*i+l]
return s}var hedotools=hedotools||{}
String.prototype.width=function(t){var e=t||"12px arial",r=$("<div>"+this+"</div>").css({position:"absolute",float:"left","white-space":"nowrap",visibility:"hidden",font:e}).appendTo($("body")),n=r.width()
return r.remove(),n},String.prototype.safe=function(){var t=this.split("/")
return t[t.length-1]=escape(t[t.length-1]),t.join("/")}
var intStr0=["zero","one","two","three","four","five","six","seven","eight","nine","then"],intStr=intStr0.slice(1,100)
hedotools.urllib={encoder:function(){function t(t){return{current:n}}function e(){GET={},query=window.location.search.substring(1).split("&")
for(var e=0,o=query.length;e<o;e++)if(""!==query[e]){var s=query[e].split("=")
GET[decodeURIComponent(s[0])]=decodeURIComponent(s[1]||"")}baseUrl=window.location.origin+window.location.pathname
var i=""
if("string"==typeof n||n instanceof String)i+=n
else{i+="["+n[0]
for(var e=1;e<n.length;e++)i+=","+n[e]
i+="]"}GET[r]=i
var l=""
for(var c in GET)GET.hasOwnProperty(c)&&(r===c?a&&(l+=c+"="+GET[c]+"&"):l+=c+"="+GET[c]+"&")
return l=l.substring(0,l.length-1),l.length>0?newDataUrl=baseUrl+"?"+l:newDataUrl=baseUrl,window.history.replaceState("object or string","title",newDataUrl),t}var r="tmp",n=[],a=!0
return t.varname=function(e){return arguments.length?(r=e,t):r},t.destroy=function(){a=!1,e(),a=!0},t.varval=function(t){return arguments.length?(n=t,e()):n},t},decoder:function(){function t(t){return e(),{current:n,cached:a}}function e(){GET={},query=window.location.search.substring(1).split("&")
for(var e=0,o=query.length;e<o;e++)if(""!==query[e]){var s=query[e].split("=")
GET[decodeURIComponent(s[0])]=decodeURIComponent(s[1]||"")}if(r in GET)if(GET[r].length>0&&"["===GET[r][0]){if("]"===GET[r][GET[r].length-1])var i=GET[r].substring(1,GET[r].length-1).split(",")
else var i=GET[r].substring(1,GET[r].length).split(",")
n=i,a=i}else n=GET[r],a=GET[r]
else n=""
return t}var r="tmp",n=[],a=[]
return t.varname=function(t){return arguments.length?(r=t,e()):r},t.varresult=function(e){return arguments.length?(n=e,a=e,t):n},t}},hedotools.barchartoncall=function(){return{test:function(t,e){if(e=indices[e],stateSelType?(shiftComp=e,d3.select(".complabel").text(allData[e].name),compencoder.varval(allData[e].name)):(shiftRef=e,d3.select(".reflabel").text(allData[e].name),refencoder.varval(allData[e].name)),shiftRef!==shiftComp){hedotools.shifter.shift(allData[shiftRef].freq,allData[shiftComp].freq,lens,words)
var r=hedotools.shifter._compH()>hedotools.shifter._refH()?"happier":"less happy"
hedotools.shifter.setfigure(d3.select("#shift01")).setText(["Why "+allData[shiftComp].name+" is "+r+" than "+allData[shiftRef].name+":"]).plot()}}}}(),hedotools.barchart=function(){var t,e,r,n,a,o=function(e){return t=e,hedotools.barchart},s="Happiness difference from US as a whole",i=function(t){return arguments.length?(s=t,hedotools.barchart):s},l=function(t,a){e=t,n=a,r=Array(n.length)
for(var o=0;o<n.length;o++)r[o]=n[o].properties.name
return hedotools.barchart},c=function(t){return arguments.length?(e=t,hedotools.barchart):e},u=function(t){return arguments.length?(r=t,hedotools.barchart):r},f=730,h=function(t){return arguments.length?(f=t,hedotools.barchart):f},d=[],p=function(t){return arguments.length?(d=t,hedotools.barchart):d}
return{setfigure:o,setdata:l,_data:c,_manualTicks:p,_datanames:u,_figheight:h,_xlabeltext:i,getSorted:function(t){return arguments.length&&t?a.map(function(t,e){return e+1+". "+t[2]}):a.map(function(t){return t[2]})},plot:function(){for(var n={top:0,right:0,bottom:0,left:0},o={top:0,right:0,bottom:50,left:0},i=parseInt(t.style("width"))-n.left-n.right,l=i-o.left-o.right,c=f-o.top-o.bottom,u=l/2,h=(o.left,Array(e.length)),p=0;p<e.length;p++)h[p]=p
h.sort(function(t,r){return e[t]<e[r]?1:e[t]>e[r]?-1:0}),a=Array(e.length)
for(var p=0;p<e.length;p++)a[p]=[p,h[p],r[h[p]],e[h[p]]]
t.select(".canvas").remove()
var x,m=t.append("svg").attr("width",i).attr("height",f).attr("class","canvas").attr("id","barchartsvg"),g=d3.max([d3.max(e),-d3.min(e)]),v=d3.scale.linear().domain([-g,g]).range([5,l-10]),y=d3.scale.linear().domain([e.length,1]).range([c-20,5]),w=m.append("g").attr("transform","translate("+o.left+","+o.top+")").attr("width",l).attr("height",c).attr("class","main"),b=(w.append("svg:line").attr("x1",l).attr("y1",c).attr("x2",o.left).attr("y2",c).style({"stroke-width":"1",stroke:"rgb(10,10,10)"}),function(){return d3.svg.axis().ticks(4).scale(v).orient("bottom")})
x=d.length>0?b().innerTickSize(6).outerTickSize(0).tickValues(d):b().innerTickSize(6).outerTickSize(0),w.append("g").attr("class","x axis ").attr("font-size","14.0px").attr("transform","translate(0,"+c+")").call(x),d3.selectAll(".tick line").style({stroke:"black"}),m.append("text").text(s).attr("class","axes-text").attr("x",l/2+(i-l)/2).attr("y",3*(f-c)/4+c).attr("font-size","16.0px").attr("fill","#000000").attr("style","text-anchor: middle;"),w.selectAll("rect.staterect").data(a).enter().append("rect").attr("class",function(t,e){return t[2]+" staterect q"+classColor(e+1)+"-8"}).attr("x",function(t,e){return t[3]>0?u:v(t[3])}).attr("y",function(t,e){return y(e+1)}).style({opacity:"1.0","stroke-width":"1.0",stroke:"rgb(100,100,100)"}).attr("height",function(t,e){return 11}).attr("width",function(t,e){return t[3]>0?d3.max([v(t[3])-u,0]):d3.max([u-v(t[3]),0])}).on("mouseover",function(t,e){d3.select(this).style({opacity:"1.0",stroke:"black","stroke-width":"1.0"}),hedotools.barchartoncall.test(t,e)}).on("mouseout",function(t){d3.select(this).style({opacity:"1.0",stroke:"rgb(100,100,100)","stroke-width":"1.0"})}),w.selectAll("text.statetext").data(a).enter().append("text").attr("class",function(t,e){return t[2]+" statetext"}).attr("x",function(t,e){return t[3]>0?u-6:u+6}).style("text-anchor",function(t,e){return t[3]>0?"end":"start"}).attr("y",function(t,e){return y(e+1)+11}).text(function(t,e){return e+1+". "+t[2]}).on("mouseover",function(t,e){hedotools.barchartoncall.test(t,e)})}}},hedotools.lensoncall=function(){return{test:function(t){console.log("set on load (works for maps.html)")
for(var e=0;e<allData.length;e++)for(var r=0;r<allData[e].rawFreq.length;r++){for(var n=!0,a=0;a<ignoreWords.length;a++)ignoreWords[a]==words[r]&&(n=!1)
lens[r]>=t[0]&&lens[r]<=t[1]&&(n=!1),allData[e].freq[r]=n?allData[e].rawFreq[r]:0}if(hedotools.computeHapps.go(),hedotools.map.setfigure(d3.select("#map01")).setdata(geoJson).plot(),shiftRef!==shiftComp){hedotools.shifter.shift(allData[shiftRef].freq,allData[shiftComp].freq,lens,words)
var o=hedotools.shifter._compH()>hedotools.shifter._refH()?"happier":"less happy"
hedotools.shifter.setfigure(d3.select("#shift01")).setText(["Why "+allData[shiftComp].name+" is "+o+" than "+allData[shiftRef].name+":"]).plot()}}}}(),hedotools.lens=function(){var t,e,r,n,a,o=hedotools.urllib.encoder().varname("lens"),s=hedotools.urllib.decoder().varname("lens").varresult([4,6]),i={top:0,right:55,bottom:0,left:0},l=100-i.top-i.bottom,c=.875*l-5,u=function(){r=parseInt(t.style("width"))-i.left-i.right,n=.875*r-5,a=.125*r},f=function(e){return console.log("setting figure"),t=e,u(),hedotools.lens},h=function(t){return e=t,hedotools.lens}
lensExtent=s().cached
var d=function(){function s(){if(d3.event.sourceEvent){var t=z.extent(),e=t
p(),e[0]===lensExtent[0]&&e[1]===lensExtent[1]||(lensExtent=[Math.round(4*e[0])/4,Math.round(4*e[1])/4],hedotools.lensoncall.test(e)),d3.select(this).transition().call(z.extent(lensExtent)).call(z.event),o.varval(lensExtent)}}function u(){r=parseInt(d3.select("#lens01").style("width"))-i.left-i.right,n=.775*r,f.attr("width",r),h.range([0,n]),g.attr("width",n),A.attr("d",b),f.select(".x.axis").call(y),f.selectAll(".distrect").attr("transform",function(t){return"translate("+h(t.x)+","+x(t.y)+")"}),d3.selectAll(".tick line").style({stroke:"black"}),k.range([a,a+n]),z.x(k),d3.select(".lensbrush").call(z.extent(lensExtent)).call(z.event)}if(r>10){t.selectAll(".canvas").remove()
var f=t.append("svg").attr("width",r).attr("height",l).attr("id","lenssvg").attr("class","canvas"),h=d3.scale.linear().domain([1,9]).range([0,n]),d=d3.layout.histogram().bins(h.ticks(65))(e),x=d3.scale.linear().domain([0,d3.max(d,function(t){return t.y})]).range([c,0]),m=f.append("g").attr("transform","translate("+.125*r+","+0*l+")").attr("width",n).attr("height",c).attr("class","main"),g=m.append("svg:rect").attr("width",n).attr("height",c).attr("class","bg").style({"stroke-width":"2",stroke:"rgb(0,0,0)"}).attr("fill","#FFFFF0"),v=function(){return d3.svg.axis().ticks(3).scale(x).orient("left")}().innerTickSize(6).outerTickSize(0)
m.append("g").attr("class","top").attr("transform","translate(0,0)").attr("font-size","12.0px").call(v)
var y=function(){return d3.svg.axis().scale(h).ticks(9).orient("bottom")}().innerTickSize(6).outerTickSize(0)
m.append("g").attr("class","x axis ").attr("font-size","12.0px").attr("transform","translate(0,"+c+")").call(y),d3.selectAll(".tick line").style({stroke:"black"})
m.append("svg:clipPath").attr("id","clip").append("svg:rect").attr("x",0).attr("y",80).attr("width",n).attr("height",c-80)
f.append("text").text("Num Words").attr("class","axes-text").attr("x",(r-n)/4).attr("y",l/2+30).attr("font-size","12.0px").attr("fill","#000000").attr("transform","rotate(-90.0,"+(r-n)/4+","+(l/2+30)+")")
var w=(d3.mean(e),m.selectAll(".distrect").data(d).enter().append("g").attr("class","distrect").attr("fill",function(t,e){return t.x,"#D3D3D3"}).attr("transform",function(t){return"translate("+h(t.x)+","+x(t.y)+")"})),b=(w.append("rect").attr("x",1).attr("width",h(d[0].dx+1)-2).attr("height",function(t){return c-x(t.y)}),d3.svg.line().x(function(t,e){return h(t.x)}).y(function(t){return x(t.y)}).interpolate("linear")),A=m.append("path").datum(d).attr("class","line").attr("d",b).attr("stroke","black").attr("stroke-width",3).attr("fill","none"),k=d3.scale.linear().domain([1,9]).range([.125*r,n+.125*r]),z=d3.svg.brush().x(k).extent(lensExtent).on("brushend",s)
f.append("g").attr("class","lensbrush").call(z).call(z.event).selectAll("rect").attr("height",c).attr("y",0).style({"stroke-width":"2",stroke:"rgb(100,100,100)",opacity:.95}).attr("fill","#FCFCFC"),d3.select(window).on("resize.selectlens",u),t.selectAll("div.btn-group-vertical").remove()
var F=t.append("div").attr({class:"btn-group-vertical pull-right"}),D=[[4,6],[3,7],[5,5]],C=["Default","Wide","None"]
F.selectAll("button").data(D).enter().append("button").attr({type:"button",class:function(t,e){return"btn btn-default btn-xs "+C[e]}}).html(function(t,e){return C[e]}).on("click",function(e,r){t.selectAll("button").attr("class","btn btn-default btn-xs"),d3.select(this).attr("class","btn btn-primary btn-xs"),d3.select(".lensbrush").call(z.extent(e)).call(z.event)}),console.log(lensExtent)
for(var M=0;M<D.length;M++)D[M][0]===parseFloat(lensExtent[0])&&D[M][1]===parseFloat(lensExtent[1])&&F.select("button."+C[M]).attr("class","btn btn-primary btn-xs")}},p=function(){console.log("I got called")}
return{setfigure:f,setdata:h,plot:d,onredrawfunction:p}},hedotools.map=function(){function t(t,e,r){function n(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t}var a,o,s
if(0==e)a=o=s=r
else{var i=r<.5?r*(1+e):r+e-r*e,l=2*r-i
a=n(l,i,t+1/3),o=n(l,i,t),s=n(l,i,t-1/3)}return[Math.round(255*a),Math.round(255*o),Math.round(255*s)]}var e,r,n=function(t){return console.log("setting figure"),e=t,hedotools.map},a=d3.scale.quantize().range([0,1,2,3,4,5,6]).domain([50,1])
return{setfigure:n,setdata:function(t){return r=t,hedotools.map},plot:function(){function n(t,e){activeHover?(activeHover=!1,d3.selectAll(".state").style("fill",null),stateSelType,d3.selectAll(".state."+allData[e].name[0]+allData[e].name.split(" ")[allData[e].name.split(" ").length-1]).attr("stroke-width",3)):(activeHover=!0,d3.selectAll(".state").attr("stroke-width",.7))}function o(t,e){var r=this.getBBox(),n=Math.floor(r.x+r.width/2),a=Math.floor(r.y+r.height/2),o="Words Used: "+commaSeparateNumber(d3.sum(allData[e].freq)),s="Total Words: "+commaSeparateNumber(d3.sum(allData[e].rawFreq)),i="US Words Used: "+commaSeparateNumber(d3.sum(allData[51].freq)),c="US Total Words: "+commaSeparateNumber(d3.sum(allData[51].rawFreq)),f="Average Happiness: "+allData[e].avhapps.toFixed(2)
hoverboxheight=176,hoverboxwidth=d3.max([o.width("13px arial"),f.width("15px arial"),s.width("13px arial"),i.width("13px arial"),c.width("13px arial")])+20,hoverboxxoffset=60
var h=30
n+hoverboxwidth+hoverboxxoffset>l&&(hoverboxxoffset=-hoverboxxoffset-hoverboxwidth),a-hoverboxheight/2-h<0&&(h=-30)
var d=u.append("g").attr({class:"hoverinfogroup",transform:"translate("+(n+hoverboxxoffset)+","+(a-hoverboxheight/2-h)+")"})
if(d.append("rect").attr({class:"hoverinfobox",x:0,y:0,width:hoverboxwidth,height:hoverboxheight,fill:"white",stroke:"black"}),d.append("text").attr({class:"hoverinfotext",x:10,y:15,"font-size":15}).text(allData[e].name),d.append("line").attr({class:"hoverinfotext",x:10,y:15,"font-size":15}).text(allData[e].name),d.append("text").attr({class:"hoverinfotext",x:10,y:38,"font-size":17}).text("Rank:"),d.append("text").attr({class:"hoverinfotext",x:59,y:55,"font-size":40}).text(sortedStateList[e]),d.append("text").attr({class:"hoverinfotext",x:105,y:56,"font-size":20}).text("out of 51"),d.append("text").attr({class:"hoverinfotext",x:10,y:79,"font-size":15}).text(f),d.append("text").attr({class:"hoverinfotext",x:10,y:97,"font-size":13}).text(o),d.append("text").attr({class:"hoverinfotext",x:10,y:114,"font-size":13}).text(s),d.append("text").attr({class:"hoverinfotext",x:10,y:131,"font-size":13}).text("US Average Happiness: "+allData[51].avhapps.toFixed(2)),d.append("text").attr({class:"hoverinfotext",x:10,y:148,"font-size":13}).text(i),d.append("text").attr({class:"hoverinfotext",x:10,y:165,"font-size":13}).text(c),activeHover&&(stateSelType?(shiftComp=e,d3.select(".complabel").text(allData[e].name),compencoder.varval(allData[e].name)):(shiftRef=e,d3.select(".reflabel").text(allData[e].name),refencoder.varval(allData[e].name)),d3.selectAll(".state."+allData[e].name[0]+allData[e].name.split(" ")[allData[e].name.split(" ").length-1]).style("fill","#428bca"),shiftRef!==shiftComp)){hedotools.shifter.shift(allData[shiftRef].freq,allData[shiftComp].freq,lens,words)
var p=hedotools.shifter._compH()>hedotools.shifter._refH()?"happier":"less happy"
hedotools.shifter.setfigure(d3.select("#shift01")).setText(["Why "+allData[shiftComp].name+" is "+p+" than "+allData[shiftRef].name+":"]).plot()}}function s(t,e){d3.select(".hoverinfogroup").remove(),activeHover&&d3.select(this).style("fill",null)}function i(){l=parseInt(e.style("width")),c=650*l/900,m.translate([l/2,c/2]).scale(1.3*l),u.selectAll("path").attr("d",g),u.attr("width",l).attr("height",c)}var l=parseInt(e.style("width")),c=650*l/900
e.select(".canvas").remove()
var u=e.append("svg").attr("class","map canvas").attr("id","mapsvg").attr("width",l).attr("height",c),f=[!1,!0],h=["Reference","Comparison"],d=h.map(function(t){return t.width()}),p=(f.length,d3.sum(d),d3.scale.linear().domain([340,730]).range([0,1])),x=p(l)
!function(t,e,r){var n=[0,1,2,3,4,5,6],a=[t,t,t,t,t,t,t],o=.25*n.length*2-.25+0+d3.sum(a),s=u.append("g").attr({class:"legendgroup",transform:"translate("+(l-50-o)+","+(c-e-e-2)+")"})
s.selectAll("rect.legendrect").data(n).enter().append("rect").attr({class:function(t,e){return"q"+e+"-8"},x:function(t,e){return 0===e?0:d3.sum(a.slice(0,e))+.25*e+.25*(e-1)+0},y:0,width:function(t,e){return a[e]},height:e,"stroke-width":"1",stroke:"rgb(0,0,0)"}),s.selectAll("text.legendtext").data(["less happy","happier"]).enter().append("text").attr({x:function(t,e){return 0==e?0:o-t.width(r+"px arial")},y:e+e,class:function(t,e){return"legendtext"},"font-size":r+"px"}).text(function(t,e){return t})}(20+10*x,8+5*x,9+3*x)
var m=d3.geo.albersUsa().translate([l/2,c/2]).scale(1.3*l),g=d3.geo.path().projection(m),v=[240,60],y=Array(20),w=Array(20)
for(b=0;b<20;b++)y[b]=t((v[0]+(v[1]-v[0])/19*b)/360,1,.5),w[b]="rgb("+y[b][0]+","+y[b][1]+","+y[b][2]+")"
color=d3.scale.quantize().range(w).domain([d3.min(allData,function(t){return t.avhapps}),d3.max(allData,function(t){return t.avhapps})]),indices=Array(allData.length-1)
for(var b=0;b<allData.length-1;b++)indices[b]=b
indices.sort(function(t,e){return Math.abs(allData[t].avhapps)<Math.abs(allData[e].avhapps)?1:Math.abs(allData[t].avhapps)>Math.abs(allData[e].avhapps)?-1:0}),sortedStates=Array(allData.length-1)
for(var b=0;b<allData.length-1;b++)sortedStates[b]=[b,indices[b],allStateNames[indices[b]]]
sortedStateList=Array(allData.length)
for(var b=0;b<allData.length;b++)sortedStateList[indices[b]]=b+1
stateFeatures=topojson.feature(r,r.objects.states).features
var A=u.selectAll("path").data(stateFeatures)
A.enter().append("path").attr("d",function(t,e){return g(t.geometry)}).attr("id",function(t,e){return t.properties.name}).attr("class",function(t,e){return"state map "+t.properties.name[0]+t.properties.name.split(" ")[t.properties.name.split(" ").length-1]+" q"+a(sortedStateList[e])+"-8"}).on("mousedown",n).on("mouseover",o).on("mouseout",s),A.exit().remove(),A.attr("stroke","black").attr("stroke-width",".7"),d3.select(window).on("resize.map",i)}}},hedotools.sankeyoncall=function(){return{test:function(t,e){console.log("set in module"),console.log(allDataOld),hedotools.shifter.shift(allDataOld[e[t].index].freq,allData[e[t].index].freq,lens,words)
var r=hedotools.shifter._compH()>hedotools.shifter._refH()?"happier":"less happy"
hedotools.shifter.setfigure(d3.select("#shift01")).setText(["Why "+e[t].name+" has become "+r+":"]).plot()}}}(),hedotools.sankey=function(){var t,e,r,n,a,o,s,i,l,c,u,f,h,d,p,x,m,g,v,y,w,b,A,k,z,F,D,C=function(t){return console.log("setting figure"),e=t,hedotools.sankey},M=function(t,e,l){r=t,n=e,a=l,"District of Columbia"===a[50]&&(a[50]="DC"),o=Array(r.length)
for(var c=0;c<r.length;c++)o[c]=c
o.sort(function(t,e){return r[t]<r[e]?1:r[t]>r[e]?-1:0}),s=Array(n.length)
for(var c=0;c<n.length;c++)s[c]=c
s.sort(function(t,e){return n[t]<n[e]?1:n[t]>n[e]?-1:0}),i=Array(r.length)
for(var c=0;c<i.length;c++)i[c]={name:a[c],index:c,oldindex:o.indexOf(c),newindex:s.indexOf(c),change:n[c]-r[c],oldhapps:r[c],newhapps:n[c]}
return hedotools.sankey},R=[0,0],S=!1,T=function(){function a(){console.log("hiding hover"),d3.selectAll("path").transition().duration(500).style("opacity","1.0"),S&&o.style({visibility:"hidden"})}if(l={top:0,right:0,bottom:0,left:0},c={top:0,right:90+R[0],bottom:0,left:90+R[1]},(u=parseInt(e.style("width"))-l.left-l.right)<450)return console.log("width is too small..."),d3.selectAll(".reftimelabel,.comptimelabel,.reftimelabelbottom,.comptimelabelbottom").remove(),e.append("text").text("Unfortunately, this visualization will look terrible on your device. If you're on a phone, try rotating and refreshing, or looking from a desktop. Thanks :)"),hedotools.sankey
f=1.8+3.4*(r.length-51)/253,h=parseInt(e.style("width"))*f-l.top-l.bottom,d=u-c.left-c.right,p=h-c.top-c.bottom,x=d/2,m=c.left
var o=e.append("div").attr({class:"hoverinfogroup"}).style({position:"absolute",top:"100px",left:"100px",visibility:"hidden"})
e.select(".canvas").remove(),g=e.append("svg").attr("width",u).attr("height",h).attr("id","sankeysvg").attr("class","canvas"),v=d3.scale.linear().domain([0,1]).range([5,d-10]),y=d3.scale.linear().domain([n.length,1]).range([p-20,5]),w=g.append("g").attr("transform","translate("+c.left+","+c.top+")").attr("width",d).attr("height",p).attr("class","main"),b=w.selectAll("text.statetext.old").data(i).enter().append("text").attr("class",function(t,e){return t.name+" statetext"}).attr("x",20).style("text-anchor","end").attr("y",function(t,e){return y(t.oldindex+1)+11}).text(function(t,e){return t.oldindex+1+". "+t.name}),newstateselection=w.selectAll("text.statetext.new").data(i).enter().append("text").attr("class",function(t,e){return t.name+" statetext"}).attr("x",d-20).style("text-anchor","start").attr("y",function(t,e){return y(t.newindex+1)+11}).text(function(t,e){return t.newindex+1+". "+t.name})
var s=d3.sankey()
A=s.link(),k=Array(r.length)
for(var D=0;D<i.length;D++)k[D]={source:{x:20,dx:2,y:y(i[D].oldindex+1)-8},target:{x:d-22,dx:2,y:y(i[D].newindex+1)-8},name:i[D].name,oldhapps:i[D].oldhapps,newhapps:i[D].newhapps,oldindex:i[D].oldindex,newindex:i[D].newindex,sy:10,ty:10,dy:10}
return z=d3.scale.linear().domain(d3.extent(i.map(function(t){return Math.abs(t.change)}))).range([2,13]),F=w.selectAll("path.sankey").data(k).enter().append("path").attr({d:A,fill:"none",class:function(t,e){return"r"+classColor(i[e].oldindex)+"-8"},"stroke-width":function(t,e){return z(Math.abs(i[e].change))}}).on("mouseover",function(e,r){var n=this
if(hedotools.sankeyoncall.test(r,i),d3.selectAll("path").transition().duration(750).style("opacity","0.1"),d3.select(this).transition().duration(5).style("opacity","1.0"),S){var s=d3.mouse(n)[0],l=d3.mouse(n)[1],c=190
refcity.length>0&&(c=270),l+c>p&&(l-=l+c-p),o.style({position:"absolute",top:l+"px",left:s+"px",visibility:"visible"}),o.selectAll("p,h3,button,br").remove(),o.append("h3").attr("class","cityname").text(e.name),o.append("p").attr("class","refhapps").text(reftimeseldecoder().cached+" Happiness: "+parseFloat(e.oldhapps).toFixed(2)),o.append("p").attr("class","refrank").text(reftimeseldecoder().cached+" Rank: "+(e.oldindex+1)),o.append("p").attr("class","comphapps").text(comptimeseldecoder().cached+" Happiness: "+parseFloat(e.newhapps).toFixed(2)),o.append("p").attr("class","comprank").text(comptimeseldecoder().cached+" Rank: "+(e.newindex+1))
var u=function(t,e,r,n){refshifttimeencoder.varval(t),refshiftcityencoder.varval(e),compshifttimeencoder.varval(r),compshiftcityencoder.varval(n),drawShift=function(){hedotools.shifter._refF(i),hedotools.shifter._compF(l),hedotools.shifter.stop(),hedotools.shifter.shifter(),hedotools.shifter.setText(["Why "+n+" in "+r+" is "+(hedotools.shifter._compH()>hedotools.shifter._refH()?"happier":"less happy")+" than "+e+" in "+t+":"]).plot(),$("#myModal").modal("show")}
var a=2,o="http://hedonometer.org/data/cities/word-vectors/"+t+"/"+e+".csv"
parseInt(t)<2014&&(o+=".new")
var s="http://hedonometer.org/data/cities/word-vectors/"+r+"/"+n+".csv"
parseInt(r)<2014&&(s+=".new"),console.log(o),console.log(s)
var i,l
d3.text(o,function(t){i=t.split(","),console.log(i),--a||drawShift()}),d3.text(s,function(t){l=t.split(","),console.log(l),--a||drawShift()})}
o.append("button").attr("class","btn btn-sm btn-primary").text("Shift city vs previous year").on("click",function(){console.log(e),console.log(r),u(reftimeseldecoder().cached,e.name,comptimeseldecoder().cached,e.name)}),o.append("br"),o.append("br"),o.append("button").attr("class","btn btn-sm btn-primary").text("Shift city in "+reftimeseldecoder().cached+" vs sum "+reftimeseldecoder().cached).on("click",function(){console.log(e),console.log(r),u(reftimeseldecoder().cached,"US",reftimeseldecoder().cached,e.name)}),o.append("br"),o.append("br"),o.append("button").attr("class","btn btn-sm btn-primary").text("Shift city in "+comptimeseldecoder().cached+" vs sum "+comptimeseldecoder().cached).on("click",function(){console.log(e),console.log(r),u(comptimeseldecoder().cached,"US",comptimeseldecoder().cached,e.name)}),o.append("br"),o.append("br"),o.append("button").attr("class","btn btn-xs btn-primary").text("Select as reference for city-city comparison").on("click",function(){console.log(e),console.log(r),refcity=e.name}),refcity.length>0&&(o.append("br"),o.append("br"),o.append("button").attr("class","btn btn-xs btn-primary").text("Compare against "+refcity+" in "+comptimeseldecoder().cached).on("click",function(){console.log(e),console.log(r),u(comptimeseldecoder().cached,refcity,comptimeseldecoder().cached,e.name)}),o.append("br"),o.append("br"),o.append("button").attr("class","btn btn-xs btn-primary").text("Compare against "+refcity+" in "+reftimeseldecoder().cached).on("click",function(){console.log(e),console.log(r),u(reftimeseldecoder().cached,refcity,reftimeseldecoder().cached,e.name)}))}clearTimeout(t),t=setTimeout(a,3e3)}).on("mouseout",function(e,r){var n=500
S&&(n=3e3,clearTimeout(t),t=setTimeout(a,n)),clearTimeout(t),t=setTimeout(a,n)
d3.select(this).style({opacity:"1.0"})}),hedotools.sankey},Q=function(){console.log(i),b.data(i).transition().duration(3e3).text(function(t,e){return t.oldindex+1+". "+t.name}).attr("y",function(t,e){return y(t.oldindex+1)+11}),newstateselection.data(i).transition().duration(3e3).text(function(t,e){return t.newindex+1+". "+t.name}).attr("y",function(t,e){return y(t.newindex+1)+11})
for(var t=0;t<i.length;t++)k[t]={source:{x:20,dx:2,y:y(i[t].oldindex+1)-8},target:{x:d-22,dx:2,y:y(i[t].newindex+1)-8},name:i[t].name,oldhapps:i[t].oldhapps,newhapps:i[t].newhapps,oldindex:i[t].oldindex,newindex:i[t].newindex,sy:10,ty:10,dy:10}
return z.domain(d3.extent(i.map(function(t){return Math.abs(t.change)}))),F.data(k).transition().duration(3e3).attr({d:A,"stroke-width":function(t,e){return z(Math.abs(i[e].change))}}),hedotools.sankey}
return{plot:T,setfigure:C,setdata:M,data:function(){return i},newindices:function(){return s},replot:Q,setTitles:function(t){return D=t,hedotools.sankey},setSideWidth:function(t){return R=t,hedotools.sankey},setTipOn:function(){return S=!0,hedotools.sankey}}},hedotools.shifter=function(){function t(){st.selectAll(".sumrectR,.sumrectL").style({opacity:"0.7"}),tt=!1,b=-1,st.selectAll("rect.shiftrect").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),st.selectAll("text.shifttext").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"}),_.varval("none"),_.destroy()}function e(e){if(st.selectAll(".resetbutton").remove(),e){var r=F.append("g").attr("transform","translate(4,"+(56+j)+") rotate(-90)").attr("class","resetbutton")
r.append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("width",48).attr("height",17).attr("fill","#F0F0F0").style({"stroke-width":"0.5",stroke:"rgb(0,0,0)"}),r.append("text").text("Reset").attr("x",6).attr("y",13).attr("font-size",Le),r.append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("width",48).attr("height",18).attr("fill","white").style({opacity:"0.0"}).on("click",function(){t()})}}function r(){console.log("adding the translate button")
var t=F.append("g").attr("class","translatebutton").attr("transform","translate(4,"+(136+j)+") rotate(-90)")
t.append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("width",75).attr("height",17).attr("fill","#F0F0F0").style({"stroke-width":"0.5",stroke:"rgb(0,0,0)"}),t.append("text").text("Translate All").attr("x",6).attr("y",13).attr("font-size","11.0px"),t.append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("width",75).attr("height",18).attr("fill","white").style({opacity:"0.0"}).on("click",function(){for(var t=0;t<N.length-1;t++)N[t]=N[N.length-1]
N[N.length-1]=(N[N.length-1]+1)%2,q.selectAll("text.shifttext").transition().duration(1e3).text(function(t,e){return N[e]?c[e]:i[e]})})}function n(){return 1}var o,s,i,l,c,u,f,h,d,p,x,m,g,v,y,w,b,A,k,z,F,D,C,M,R,S,T,Q,L,H,E,q,I,W,N,B,P,X,j,U,O,G,V,Y,J,K,Z,_=hedotools.urllib.encoder().varname("wordtypes"),$=hedotools.urllib.decoder().varname("wordtypes").varresult("none"),tt=!1,b=-1,et=hedotools.urllib.encoder().varname("viz"),rt=hedotools.urllib.decoder().varname("viz").varresult("wordshift"),nt=!1,at=function(t){var e=this
return arguments.length?(nt=t,e):nt},ot=4,st=d3.select("body"),it=!1,lt=function(){return st},ct=function(t){var e=this
return console.log("setting figure for wordshift"),st=t,st=st.append("div").attr({class:"outwrapper"}).style({position:"relative"}),it||Ft(),e},ut=!1,ft=function(t){var e=this
return arguments.length?(ut=t,vt.bottom=vt.bottom+10,e):ut},ht=function(t,e,r){for(var n,a=r||Yt[Yt.length-1]+"px  "+Fe,o=[],s=0;s<t.length;s++){if(t[s].width(a)<e)n=[t[s]]
else for(var i=t[s].split(" "),l=!1,c=0;!l;){c+=1
var u=i.slice(0,i.length-c).join(" ")
u.width(a)<e&&(n=[u,i.slice(i.length-c,i.length).join(" ")],l=!0)}o=o.concat(n)}return o},dt=400,pt=550,xt={top:0,right:0,bottom:0,left:0},mt=dt-xt.left-xt.right,gt=pt-xt.top-xt.bottom,vt={top:0,right:3,bottom:25,left:23},yt=mt-vt.left-vt.right,wt=gt-vt.top-vt.bottom,bt=(vt.left,11),At=28,kt=64,zt=yt/2,Ft=function(){dt=d3.min([parseInt(st.style("width")),dt]),mt=dt-xt.left-xt.right,yt=mt-vt.left-vt.right,zt=yt/2},Dt=function(t){if(!arguments.length)return dt
it=!0,dt=t,mt=dt-xt.left-xt.right,yt=mt-vt.left-vt.right,zt=yt/2},Ct=function(t){var e=this
return arguments.length?(pt=t,gt=pt-xt.top-xt.bottom,wt=gt-vt.top-vt.bottom,e):pt},Mt=function(t){var e=this
return arguments.length?(o=t,e):o},Rt=function(t){var e=this
return arguments.length?(s=t,e):s},St=function(t){var e=this
return arguments.length?(i=t,e):i},Tt=function(t){var e=this
return arguments.length?(l=t,e):l},Qt="Per word average happiness shift",Lt=function(t){var e=this
return arguments.length?(Qt=t,e):Qt},Ht="Word Rank",Et=function(t){var e=this
return arguments.length?(Ht=t,e):Ht},qt=function(t){var e=this
return arguments.length?(f=t,e):f},It=function(t){var e=this
return arguments.length?(h=t,e):h},Wt=!0,Nt=function(t){var e=this
return arguments.length?(Wt=t,e):Wt},Bt=function(t){for(var e=-1,r=0;r<g.length;r++)if(t===g[r]){e=r
break}return e},Pt=function(){var t=this
return Wt=!Wt,e(Wt),Wt?(st.select("g.help").style("visibility","visible"),st.selectAll("text.credit").style("visibility","visible")):(st.select("g.help").style("visibility","hidden"),st.selectAll("text.credit").style("visibility","hidden")),t},Xt=function(t,e,r,n,a,c){var d=this
return o=t,s=e,i=r,l=r,u=n,f=a,h=c,ot=0,d},jt=!0,Ut=function(t){var e=this
return arguments.length?(jt=t,e):jt},Ot=1,Gt=function(t){var e=this
return arguments.length?(Ot=t,e):Ot},Vt=["#202020","#D8D8D8","#D8D8D8","#D8D8D8","#D8D8D8"],Yt=[16,12,12,12,12],Jt=function(t){var e=this
return arguments.length?(Vt=t,e):Vt},Kt="white",Zt=function(t){var e=this
return arguments.length?(Kt=t,e):Kt},_t=function(t){var e=this
return arguments.length?(Yt=t,e):Yt},$t=[""],te=function(t){var e=this
return arguments.length?($t=t,e):t},ee=200,re=[4,6],ne=!1,ae=function(t){var e=this
return arguments.length?(re=t,e):re},oe=function(t){var e=this
return arguments.length?(d=t,ee=d3.min([d.length,ee]),ot--,e):d},se=function(t){var e=this
return arguments.length?(p=t,ot--,e):p},ie=function(t){var e=this
return arguments.length?(x=t,ot--,e):x},le=function(t){var e=this
return arguments.length?(m=t,e):m},ce=function(t){var e=this
return arguments.length?(g=t,ot--,e):g},ue=function(t){var e=this
return arguments.length?(v=t,ne=!0,e):v},fe=["nigga","niggas","niggaz","nigger"],he=function(t){var e=this
return arguments.length?(fe=["nigga","niggas","niggaz","nigger"],fe=fe.concat(t),e):fe},de=function(){for(var t=this,e=0;e<x.length;e++){for(var r=!0,n=0;n<fe.length;n++)fe[n]==g[e]&&(r=!1)
x[e]>re[0]&&x[e]<re[1]&&(r=!1),r||(d[e]=0,p[e]=0)}return t},pe=function(t){for(var e=0;e<x.length;e++){for(var r=!0,n=0;n<fe.length;n++)fe[n]==g[e]&&(r=!1)
x[e]>re[0]&&x[e]<re[1]&&(r=!1),r||(t[e]=0)}return t},xe=function(){i=i.map(function(t,e){return 0==s[e]?(e+1+". ").concat(t.concat("-↓")):1==s[e]?(e+1+". ").concat(t.concat("+↓")):2==s[e]?(e+1+". ").concat(t.concat("-↑")):(e+1+". ").concat(t.concat("+↑"))}),ne&&(c=c.map(function(t,e){return 0==s[e]?(e+1+". ").concat(t.concat("-↓")):1==s[e]?(e+1+". ").concat(t.concat("+↓")):2==s[e]?(e+1+". ").concat(t.concat("-↑")):(e+1+". ").concat(t.concat("+↑"))}))},me=function(t,e,r,n){var a=this
return d=t,p=e,x=r,g=n,ot=0,Ae(),a},ge=!1,ve=function(t){var e=this
return arguments.length?(ge=t,e):ge},ye=function(){for(var t=this,e=0,r=d3.min([d.length,g.length,x.length]),n=0;n<r;n++)e+=parseFloat(d[n])
f=0
for(var n=0;n<r;n++)f+=d[n]*parseFloat(x[n])
f/=e,h=0,w=Array(r),b=Array(r)
for(var a=0,n=0;n<r;n++)a=d[n]/e,w[n]=(parseFloat(x[n])-f)*a,b[n]=a>0?2:0,parseFloat(x[n])>f&&(b[n]+=1)
for(var l=Array(r),n=0;n<r;n++)l[n]=n
l.sort(function(t,e){return Math.abs(w[t])<Math.abs(w[e])?1:Math.abs(w[t])>Math.abs(w[e])?-1:0}),o=Array(ee),s=Array(ee),i=Array(ee)
for(var n=0;n<ee;n++)o[n]=w[l[n]],s[n]=b[l[n]],i[n]=g[l[n]]
if(ge){sortedMagFull=Array(r),y=Array(r)
for(var n=0;n<r;n++)sortedMagFull[n]=w[l[n]],y[n]=b[l[n]]}u=[0,0,0,0]
for(var n=0;n<r;n++)u[b[n]]+=w[n]
if(ne){c=Array(ee)
for(var n=0;n<ee;n++)c[n]=v[l[n]]}return t},we=function(t){var e=this
return arguments.length?(w=t,e):w},be=function(t){var e=this
return arguments.length?(b=t,e):b},Ae=function(){for(var t=this,e=0,r=0,n=d3.min([d.length,p.length,g.length,x.length]),a=0;a<n;a++)e+=parseFloat(d[a]),r+=parseFloat(p[a])
f=0
for(var a=0;a<n;a++)f+=d[a]*parseFloat(x[a])
f/=e,h=0
for(var a=0;a<n;a++)h+=p[a]*parseFloat(x[a])
h/=r,w=Array(n),b=Array(n)
for(var m=0,a=0;a<n;a++)m=p[a]/r-d[a]/e,w[a]=(parseFloat(x[a])-f)*m,b[a]=m>0?2:0,parseFloat(x[a])>f&&(b[a]+=1)
for(var A=Array(n),a=0;a<n;a++)A[a]=a
A.sort(function(t,e){return Math.abs(w[t])<Math.abs(w[e])?1:Math.abs(w[t])>Math.abs(w[e])?-1:0}),o=Array(ee),s=Array(ee),i=Array(ee)
for(var a=0;a<ee;a++){o[a]=w[A[a]],s[a]=b[A[a]]
var k=g[A[a]]
if(k.length>22){var z=k.slice(0,20)
" "===z[z.length-1]?i[a]=z.slice(0,z.length-1)+"…":i[a]=z+"…"}else i[a]=k}if(ge){sortedMagFull=Array(n),y=Array(n)
for(var a=0;a<n;a++)sortedMagFull[a]=w[A[a]],y[a]=b[A[a]]}u=[0,0,0,0]
for(var a=0;a<n;a++)u[b[a]]+=w[a]
if(ne){c=Array(ee)
for(var a=0;a<ee;a++)c[a]=v[A[a]]}return l=i,sortedWordsRawEn=c,xe(),t},ke=function(){for(var t=this,e=0,r=0,n=d3.min([d.length,p.length,g.length,x.length]),a=0;a<n;a++)e+=parseFloat(d[a]),r+=parseFloat(p[a])
f=0
for(var a=0;a<n;a++)f+=d[a]*parseFloat(x[a])
f/=e,h=0
for(var a=0;a<n;a++)h+=p[a]*parseFloat(m[a])
h/=r,w=Array(n),b=Array(n)
for(var a=0;a<n;a++)w[a]=parseFloat(m[a])*p[a]/r-parseFloat(x[a])*d[a]/e,p[a]/r>d[a]/e?b[a]=2:b[a]=0,d[a]>0&&0==p[a]?parseFloat(x[a])>f&&(b[a]+=1):0==d[a]&&p[a]>0?parseFloat(m[a])>h&&(b[a]+=1):parseFloat(m[a])>parseFloat(x[a])&&(b[a]+=1)
for(var l=Array(n),a=0;a<n;a++)l[a]=a
l.sort(function(t,e){return Math.abs(w[t])<Math.abs(w[e])?1:Math.abs(w[t])>Math.abs(w[e])?-1:0}),o=Array(ee),s=Array(ee),i=Array(ee)
for(var a=0;a<ee;a++){o[a]=w[l[a]],s[a]=b[l[a]]
var c=g[l[a]]
if(c.length>22){var v=c.slice(0,20)
" "===v[v.length-1]?i[a]=v.slice(0,v.length-1)+"…":i[a]=v+"…"}else i[a]=c}if(ge){sortedMagFull=Array(n),y=Array(n)
for(var a=0;a<n;a++)sortedMagFull[a]=w[l[a]],y[a]=b[l[a]]}u=[0,0,0,0]
for(var a=0;a<n;a++)u[b[a]]+=w[a]
return t},ze=function(){var t=this,e=1
for(z=-1;e>Math.pow(10,-6);)z++,e=Math.abs(sortedMagFull[z])
A=Array(100),k=Array(100)
for(var r=Math.floor(z/100),n=0;n<100;n++){A[n]=Array(5),k[n]=Array(5)
for(var a=0;a<5;a++)A[n][a]=0,k[n][a]=0
A[n][4]=d3.sum(sortedMagFull.slice(n*r,(n+1)*r))
for(var a=n*r;a<(n+1)*r;a++)A[n][y[a]]+=sortedMagFull[a]}for(var a=0;a<5;a++)k[0][a]=A[0][a]
for(var n=1;n<100;n++)for(var a=0;a<5;a++)k[n][a]=k[n-1][a]+A[n][a]
return t},Fe="Latex default, serif",De=function(t){var e=this
return arguments.length?(Fe=t,e):Fe},Ce=12,Me=12,Re=16,Se=12,Te=8,Qe=8,Le=12,He=function(t){var e=this
return arguments.length?(Ce=t[0],Me=t[1],Re=t[2],Se=t[3],Te=t[4],Qe=t[5],Le=t[6],e):[Ce,Me,Re,Se,Te,Qe,Le]},Ee=["negdown","posdown","negup","posup"],qe=!1,Ie=0,We=function(){qe=!0
var t=d3.min([j-10,80])
Ie=t+40,F.append("image").attr({x:mt-t-10,y:"0",width:t,height:t,"xlink:href":"data:image/png;base64,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"}).on("click",function(){window.open("http://hedonometer.org","_blank")})},Ne="shiftsvg",Be=function(t){var e=this
return arguments.length?(Ne=t,e):Ne},Pe=function(t){var e=s[t],r=1==e||3==e?"+":"-",n=1==e||3==e?"more":"less",a=e>1?"↑":"↓",c=o[t]>0?"up":"down",u=o[t]>0?"rise":"fall",m=o[t]>0?"right":"left",g=my_shifter.get_word_index(l[t])
return'The word "'+l[t]+'" is shown as "'+i[t]+"\". Let's break that down: <br><ul><li>The "+r+" means "+l[t]+" is a "+n+" happy word than the reference average ($h_{\\textrm{avg}} {(\\textrm{"+l[t]+"})}="+x[g].toFixed(2)+"$ and $h^{\\textrm{(ref)}}_{\\textrm{avg}}="+f.toFixed(2)+"$).</li><li>The "+(e>1?"↑ means used more":"↓ means used less")+"  frequently in the comparison text than reference text ("+commaSeparateNumber(p[g])+" times to "+commaSeparateNumber(d[g])+" times, such that $p_\\textrm{"+l[t]+"}^{\\textrm{(comp)}} = "+(p[g]/d3.sum(p)).toFixed(3)+"$ and $p_\\textrm{"+l[t]+"}^{\\textrm{(ref)}}="+(d[g]/d3.sum(d)).toFixed(3)+"$).</li><li>Together this brings the comparison happiness <strong>"+(o[t]>0?"up":"down")+"</strong> by "+Math.abs(o[t]).toFixed(3)+", or "+Math.abs(o[t]/(f-h)).toFixed(2)+"%. We can see this as the individual term in the shift equations' sum:   $$\\underbrace{  \\left[  h_{\\textrm{avg}} {(\\textrm{"+l[t]+"})} – h^{\\textrm{(ref)}}_{\\textrm{avg}}  \\right]  }_{"+r+"}  \\underbrace{  \\left[  p_\\textrm{"+l[t]+"}^{\\textrm{(comp)}} – p_\\textrm{"+l[t]+"}^{\\textrm{(ref)}}  \\right]    }_{\\"+c+"arrow}.$$</li></ul>"+(1==e||3==e?"Positive, ":"Negative, ")+(e>1?" more frequent (":" less frequent (")+r+a+") words  will always be on the "+m+" contributing to a "+u+" in happiness."},Xe=function(){console.log("launching the tour")
var t=new Tour({steps:[{element:"#shiftsvg",title:"A quick wordshift whats-what",placement:"auto left",onShown:function(){console.log("first element shown"),MathJax.Hub.Queue(["Typeset",MathJax.Hub])},content:"Let’s say we have two texts which we call ‘reference’, ${T}^\\textrm{(ref)}$, and ‘comparison’, ${T}^\\textrm{(comp)}$. We want to know why the happiness of the comparison text, $h^{\\textrm{(comp)}}_{\\textrm{avg}}$, is higher or lower than that of the reference text $h^{\\textrm{(ref)}}_{\\textrm{avg}}$.<br>To do this, we analyze how each word $w$ which contributes to the difference in average happiness between the two texts:  $$h^{\\textrm{(comp)}}_{\\textrm{avg}} – h^{\\textrm{(ref)}}_{\\textrm{avg}} =   \\sum_{w \\in L}  \\underbrace{  \\left[  h_{\\textrm{avg}} {(w)} – h^{\\textrm{(ref)}}_{\\textrm{avg}}  \\right]  }_{+/-}  \\underbrace{  \\left[  p_w^{\\textrm{(comp)}} – p_w^{\\textrm{(ref)}}  \\right]    }_{\\uparrow/\\downarrow}.$$Next let's take a look at how the top three words contribute."},{element:"#shiftrect0",content:Pe(0),placement:"auto left",onShown:function(){console.log("first element shown"),MathJax.Hub.Queue(["Typeset",MathJax.Hub])}},{element:"#shiftrect1",content:Pe(1),placement:"auto left",onShown:function(){console.log("first element shown"),MathJax.Hub.Queue(["Typeset",MathJax.Hub])}},{element:"#shiftrect2",content:Pe(2),placement:"auto left",onShown:function(){console.log("first element shown"),MathJax.Hub.Queue(["Typeset",MathJax.Hub])}},{element:"#sumTextR0",content:"At the top, we see the relative contributions from each of the four words types, and the total (the grey bar). This particular bar, $\\sum +\\uparrow$, shows the relative contribution to the shift in happiness from positive words that increased in frequency. <br><br>Try clicking this bar to see only those word types. To reset the view, click the grey $\\sum$ bar.<br><br>And that's all for now, we hope this quick what's-what was helpful!",placement:"auto left",onShown:function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub])}}]})
t.init(),t.restart(),t.start(!0)},je=function(){st.append("a").attr({class:"btn btn-large btn-default"}).style({position:"absolute",left:function(){return dt-34+"px"}}).on("click",function(){Xe()}).append("i").attr({class:"fa fa-question"})},Ue=function(){function a(){if(d3.event.translate[1]>0&&E.translate([0,0]).scale(1),tt)for(var t=0;t<4;t++)q.selectAll("rect.shiftrect."+intStr0[t]).attr("transform",function(e,r){return"translate("+(b===t?e>0?zt:C(e):e>0?500:-500)+","+M(r+1)+")"}),q.selectAll("text.shifttext."+intStr0[t]).attr("transform",function(e,r){return"translate("+(b===t?e>0?C(e)+2:C(e)-2:e>0?500:-500)+","+(M(r+1)+bt)+")"})
else q.selectAll("rect.shiftrect").attr("transform",function(t,e){return t>0?"translate("+zt+","+M(e+1)+")":"translate("+C(t)+","+M(e+1)+")"}),q.selectAll("text.shifttext").attr("transform",function(t,e){return t>0?"translate("+(C(t)+2)+","+(M(e+1)+bt)+")":"translate("+(C(t)-2)+","+(M(e+1)+bt)+")"})
if(ge){var e=d3.event.translate[1]/(wt-kt),r=e*g*At/x.length
st.select(".distwin").attr({y:d3.max([2,2-r])})}}var l=this
if($t[0].length<1){if(h>=f)var d="happier"
else var d="less happy"
$t=ht(["Reference happiness: "+f.toFixed(2),"Comparison happiness: "+h.toFixed(2),"Why comparison is "+d+" than reference:"],mt-10-Ie)}else jt&&($t=ht($t,mt-10-Ie))
st.selectAll("svg").remove(),F=st.append("svg").attr("id",Ne).attr("width",function(){return mt}).attr("height",function(){return gt}),bgbgrect=F.append("rect").attr("x",0).attr("y",0).attr("width",mt).attr("height",gt).attr("class","bgbg").attr("fill",Kt),j=17*$t.length+13,wt=gt-vt.top-vt.bottom-j,D=d3.max(i.slice(0,7).map(function(t){return t.width(Se+"px  "+Fe)}))
if(C=d3.scale.linear().domain([-Math.abs(o[0]),Math.abs(o[0])]).range([D+10,yt-D-10]),M=d3.scale.linear().domain([At+1,1]).range([wt+2,kt]),E=d3.behavior.zoom().y(M).scaleExtent([1,1]).on("zoom",a),q=F.append("g").attr("transform","translate("+vt.left+","+(vt.top+j)+")").attr("width",yt).attr("height",wt).attr("class","main"),q.call(E),q.on("wheel.zoom",null),q.on("mousewheel.zoom",null),q.on("wheel",function(t){d3.event.preventDefault(),E.translate([0,E.translate()[1]+d3.event.wheelDeltaY/2]),E.event(q)}),q.on("mousewheel",function(t){d3.event.preventDefault(),E.translate([0,E.translate()[1]+d3.event.wheelDeltaY/2]),E.event(q)}),S=q.append("rect").attr({x:0,y:1,width:yt-2,height:wt-2,class:"bg"}).style({"stroke-width":"0.5",stroke:"rgb(0,0,0)",fill:Kt,opacity:".96"}),ut){O=function(){return d3.svg.axis().ticks(4).scale(C).orient("bottom")}().innerTickSize(3).outerTickSize(0),F.append("g").attr("class","x axis ").attr("font-size",Me).attr("transform","translate("+vt.left+","+(kt+wt)+")").call(O),F.selectAll(".tick line").style({stroke:"black"})}Ee=["negdown","posdown","negup","posup"]
var p=["#b3b3ff","#ffffb3","#4c4cff","#ffff4c","#272727"]
if(I=q.selectAll("rect.shiftrect").data(o).enter().append("rect").attr({class:function(t,e){return"shiftrect "+intStr0[s[e]]+" "+Ee[s[e]]},id:function(t,e){return"shiftrect"+e},x:0,y:0,transform:function(t,e){return t>0?"translate("+zt+","+M(e+1)+")":"translate("+C(t)+","+M(e+1)+")"},height:function(t,e){return bt},width:function(t,e){return t>0?C(t)-C(0):C(0)-C(t)},opacity:"0.7","stroke-width":"1",stroke:"rgb(0,0,0)",fill:function(t,e){return p[s[e]]}}),W=q.selectAll("text.shifttext").data(o).enter().append("text").attr({class:function(t,e){return"shifttext "+intStr0[s[e]]},x:0,y:0,transform:function(t,e){return t>0?"translate("+(C(t)+2)+","+(M(e+1)+bt)+")":"translate("+(C(t)-2)+","+(M(e+1)+bt)+")"}}).style({"text-anchor":function(t,e){return t<0?"end":"start"},"font-size":Se}).text(function(t,e){return i[e]}),ne){N=Array(i.length+1)
for(var m=0;m<N.length;m++)N[m]=0
N[N.length-1]=1,W.on("click",function(t,e){N[e]?(d3.select(this).text(i[e]),N[e]=0):(d3.select(this).text(c[e]),N[e]=1)})}if("posup"===$().current?(tt=!0,b=3,e(!0),q.selectAll("rect.shiftrect.zero").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"})):"negdown"===$().current?(tt=!0,b=0,e(!0),q.selectAll("rect.shiftrect.zero").attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"})):"posdown"===$().current?(tt=!0,b=1,e(!0),q.selectAll("rect.shiftrect.zero").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"})):"negup"===$().current&&(tt=!0,b=2,e(!0),q.selectAll("rect.shiftrect.zero").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"})),Q=q.append("rect").attr("x",3).attr("y",3).attr("class","topbgrect").attr("width",yt-vt.left-5).attr("height",60).attr("fill",Kt).style({opacity:"1.0"}),topbgrect2=F.append("rect").attr("x",0).attr("y",0).attr("class","topbgrect").attr("width",mt).attr("height",j).attr("fill",Kt).style({opacity:"1.0"}),X=F.selectAll("text.titletext").data($t).enter().append("text").attr("y",function(t,e){return 17*(e+1)}).attr("x",3).attr("class",function(t,e){return"titletext "+intStr[e]}).style({"font-size":function(t,e){return Yt[e]},"line-height":"1.42857143",color:function(t,e){return Vt[e]},"font-weight":function(t,e){return e<Ot?"bold":"normal"}}).text(function(t,e){return t}),bottombgrect=q.append("rect").attr("x",3).attr("y",pt-vt.bottom-j).attr("width",yt-2).attr("height",vt.bottom).attr("fill",Kt).style({opacity:"1.0"}),H=q.append("line").attr({x1:0,x2:yt-2,y1:60,y2:60}).style({"stroke-width":"1",stroke:"black"}),B=Math.max(Math.abs(u[1]),Math.abs(u[2]),u[0],u[3],d3.sum(u)),R=d3.scale.linear().domain([-B,B]).range([34.1562,yt-34.1562]),P=[u[3],u[0],d3.sum(u)],Ee=["posup","negdown","sumgrey"],p=["#ffff4c","#b3b3ff","#272727"],q.selectAll(".sumrectR").data(P).enter().append("rect").attr({class:function(t,e){return"sumrectR "+intStr0[e]+" "+Ee[e]},x:function(t,e){return t>0?zt:R(t)},y:function(t,e){return e<3?17*e+7:17*e+7-2},height:function(t,e){return 14},width:function(t,e){return t>0?R(t)-zt:zt-R(t)},fill:function(t,e){return p[e]}}).style({opacity:function(t,e){var r=[3,0,-1]
return tt&&b!==r[e]?"0.14":"0.7"},"stroke-width":"1",stroke:"rgb(0,0,0)"}).on("mouseover",function(t,e){var r=[3,0,-1]
if(tt)if(b===r[e]){d3.select(this).style({opacity:"0.7"})}else{d3.select(this).style({opacity:"0.3"})}else{d3.select(this).style({opacity:"1.0"})}}).on("mouseout",function(t,e){var r=[3,0,-1]
if(tt)if(b===r[e]){d3.select(this).style({opacity:"0.7"})}else{d3.select(this).style({opacity:"0.14"})}else{d3.select(this).style({opacity:"0.7"})}}).on("click",function(r,n){var a=[3,0,-1]
st.selectAll(".sumrectR,.sumrectL").style({opacity:"0.1"})
d3.select(this).style({opacity:"0.7"})
0==n?(tt=!0,b=a[n],e(!0),_.varval("posup"),q.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"})):1==n?(tt=!0,b=a[n],e(!0),_.varval("negdown"),q.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"})):2==n&&t()}),q.selectAll(".sumtextR").data([u[3],u[0],d3.sum(u)]).enter().append("text").style({"text-anchor":function(t,e){return t>0?"start":"end"},"font-size":Ce}).attr({class:"sumtextR",id:function(t,e){return"sumTextR"+e},y:function(t,e){return 17*e+17},x:function(t,e){return R(t)+5*t/Math.abs(t)}}).text(function(t,e){return 0==e?"∑+↑":1==e?"∑-↓":"∑"}),P=[u[1],u[2]],Ee=["posdown","negup"],p=["#ffffb3","#4c4cff"],q.selectAll(".sumrectL").data(P).enter().append("rect").attr({class:function(t,e){return"sumrectL "+intStr0[e]+" "+Ee[e]},id:function(t,e){return"sumTextL"+e},x:function(t,e){return e<2?R(t):(u[3]+u[1])*(u[0]+u[2])>0?t>0?R(u[3]+u[1]):R(t)-(zt-R(u[3]+u[1])):t>0?zt:R(t)},y:function(t,e){return 17*e+7},height:function(t,e){return 14},width:function(t,e){return t>0?R(t)-zt:zt-R(t)},fill:function(t,e){return p[e]}}).style({opacity:function(t,e){var r=[1,2]
return tt&&b!==r[e]?"0.14":"0.7"},"stroke-width":"1",stroke:"rgb(0,0,0)"}).on("mouseover",function(t,e){var r=[1,2]
if(tt)if(b===r[e]){d3.select(this).style({opacity:"0.7"})}else{d3.select(this).style({opacity:"0.3"})}else{d3.select(this).style({opacity:"1.0"})}}).on("mouseout",function(t,e){var r=[1,2]
if(tt)if(b===r[e]){d3.select(this).style({opacity:"0.7"})}else{d3.select(this).style({opacity:"0.14"})}else{d3.select(this).style({opacity:"0.7"})}}).on("click",function(t,r){var n=[1,2]
tt=!0,b=n[r],st.selectAll(".sumrectR,.sumrectL").style({opacity:"0.1"})
d3.select(this).style({opacity:"0.7"})
e(!0),0==r?(_.varval("posdown"),q.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"})):1==r&&(_.varval("negup"),q.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}))}),q.selectAll(".sumtextL").data(P).enter().append("text").style({"text-anchor":"end","font-size":Ce}).attr("class","sumtextL").attr("y",function(t,e){return 17*e+17}).text(function(t,e){return 0==e?"∑+↓":"∑-↑"}).attr("x",function(t,e){return R(t)-5}),T=F.append("text").text(Qt).attr("class","axes-text").attr("x",vt.left+zt).attr("y",gt-7).style({"font-size":Re,fill:"#000000","text-anchor":"middle"}),L=F.append("text").text(Ht).attr("class","axes-text").attr("x",18).attr("y",wt/2+60+j).attr("font-size",Re).attr("fill","#000000").attr("transform","rotate(-90.0,18,"+(wt/2+60+j)+")"),ge){ze()
var g=250
G=q.append("g").attr({class:"dist",fill:"#B8B8B8",transform:"translate(5,"+(wt-28-g)+")"}),G.append("rect").attr({x:0,y:0,height:g,width:70,class:"distbg","stroke-width":"2",stroke:"rgb(150,150,150)",fill:"#FCFCFC",opacity:"0.96"})
var v=d3.scale.linear().domain(d3.extent(A.map(function(t){return t[4]}))).range([1,68]),y=d3.scale.linear().domain([0,99]).range([2,g-2]),w=d3.svg.line().x(function(t,e){return v(t)}).y(function(t,e){return y(e)}).interpolate("cardinal"),V=(G.append("path").datum(A.map(function(t){return t[4]})).attr("class","line").attr("d",w).attr("stroke","red").attr("stroke-width",1.25).attr("fill","none"),d3.scale.linear().domain(d3.extent(k.map(function(t){return t[4]}))).range([1,68])),Y=d3.svg.line().x(function(t,e){return V(t)}).y(function(t,e){return y(e)}).interpolate("cardinal")
G.append("path").datum(k.map(function(t){return t[4]})).attr("class","line").attr("d",Y).attr("stroke","blue").attr("stroke-width",1.25).attr("fill","none"),G.append("rect").attr({x:0,y:2,height:g*At/z,width:70,class:"distwin","stroke-width":"0.75",stroke:"rgb(20,20,20)",fill:"#FCFCFC",opacity:"0.6"}),G.append("text").attr({x:72,y:g+2,class:"nwordslabel"}).style({fill:"#B8B8B8","font-size":Te,"text-anchor":"start"}).text(z)
G.append("text").attr({x:72,y:2,class:"zerolabel"}).style({fill:"#B8B8B8","font-size":Te,"text-anchor":"start"}).text("0")}return U=q.selectAll("text.credit").data(["visualization by","@andyreagan"]).enter().append("text").attr({class:"credit",x:yt-5,y:function(t,e){return wt-15+10*e}}).style({"text-anchor":"end",fill:"#B8B8B8","font-size":Qe}).text(function(t){return t}),it||d3.select(window).on("resize.shiftplot",n),Wt&&e(!0),ne&&(console.log(ne),r()),l},Oe=function(){var t=this
"table"===rt().cached&&(V.remove(),Y.remove(),J.remove(),K.remove(),Z.remove()),et.varval("cloud"),q.selectAll("rect.shiftrect").transition().duration(1e3).attr("x",1e3),q.selectAll(".sumrectR").transition().duration(2e3).attr("x",1e3),q.selectAll(".sumtextR").transition().duration(2e3).attr("x",1e3),q.selectAll(".sumrectL").transition().duration(2e3).attr("x",-1e3),q.selectAll(".sumtextL").transition().duration(2e3).attr("x",-1e3),bottombgrect.attr("y",1e3),T.transition().duration(2e3).attr("y",1e3),L.transition().duration(2e3).attr("x",-1e3),Q.transition().duration(2e3).attr("y",-200),H.transition().duration(1e3).attr({y1:-10,y2:-10})
var e=d3.scale.linear().domain([Math.abs(o[49]),Math.abs(o[0])]).range([6,70])
st.selectAll("canvas").remove(),st.append("canvas").attr({width:yt,height:wt,id:"cloudcanvas"}).style({display:"none"})
var r=document.getElementById("cloudcanvas").getContext("2d")
st.append("canvas").attr({width:yt,height:wt,id:"cloudcanvas2"}).style({display:"none"})
var n=document.getElementById("cloudcanvas2").getContext("2d")
r.textAlign="center",r.fillStyle="red",r.strokeStyle="red",r.textAlign="center",r.save()
for(var s=l.map(function(t,r){return a={},a.text=t,a.rotate=90*Math.round(1*Math.random()-.5),a.size=e(Math.abs(o[r])),a.fontString=a.size+"px  "+Fe,a.padding=1,a.x=zt+(Math.random()-.5)*yt/2,a.y=wt/2,a}),i=[yt,wt],c=[],u=-1;u++<199;){var f=s[u]
cloudSpriteSimple(n,f,i)
var h=monochrome(r.getImageData(0,0,i[0],i[1]).data);(function(t,e,r){var n=(i[0],i[1],e.x),a=e.y,o=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=i[0]/i[1],l=Math.random()<.5?1:-1
l*=2
for(var c,u,f,h=-l;(c=function(t){return[s*t*Math.cos(t),t*Math.sin(t)]}(h+=l))&&(u=c[0],f=c[1],!(Math.min(Math.abs(u),Math.abs(f))>=o));)if(e.x=n+u,e.y=a+f,!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>i[0]||e.y+e.y1>i[1])){var d={x0:Math.floor(e.x)+e.x0,y0:Math.floor(e.y)-e.y1,w:2*e.x1,h:e.y1}
d.x1=d.x0+d.w,d.y1=d.y0+d.h
for(var p=indexer2d(r,i[0],d.y0,d.y1,d.x0,d.x1),x=0;x<e.sprite.length&&(!e.sprite[x]||!p[x]);x++);if(x===e.sprite.length)return t.push(d),!0}!1})(c,f,h)
r.setTransform(1,0,0,1,0,0),r.save(),r.font=f.fontString,r.lineWidth=2*f.padding,r.translate(f.x,f.y),r.rotate(f.rotate*cloudRadians),r.fillText(f.text,0,0),r.strokeText(f.text,0,0),r.restore()}return q.selectAll("text.shifttext").data(s).filter(function(t,e){if(e<200)return 1}).text(function(t,e){return t.text}).transition().duration(1e3).delay(function(t,e){return 10*e}).attr("placed",function(t,e){return t.placed}).attr("x",function(t,e){return 0}).attr("y",function(t,e){return 0}).style("text-anchor","middle").style("font",function(t,e){return t.fontString}).attr("transform",function(t,e){return"translate("+[t.x,t.y]+")rotate("+t.rotate+")"}),t},Ge=function(){function t(){d3.event.translate[1]>0&&E.translate([0,0]).scale(1),m.attr("transform",function(t,e){return"translate("+(t>0?p:C(t)+a)+","+(M(e+1)+2.5)+")"}),g.attr("transform",function(t,e){return"translate("+n+","+(M(e+1)+bt)+")"}),V.attr("y",function(t,e){return M(e+1)+bt}),J.attr("y",function(t,e){return M(e+1)+bt}),Y.attr("y",function(t,e){return M(e+1)+bt}),K.attr("y",function(t,e){return M(e+1)+bt})}var r=this
et.varval("table")
var n=20,a=n+70+25+25+35,u=yt-a,d=["start","start","middle","middle","end","middle"]
xpadding=10
var p=a+u/2,x=[0,n,n+70,n+70+25,n+70+25+25+35,p]
C.domain([-Math.abs(o[0]),Math.abs(o[0])]).range([xpadding,u-xpadding]),kt=15,M.range([wt+2,kt]),e(!1)
var m=q.selectAll("rect.shiftrect").data(o),g=q.selectAll("text.shifttext").data(o)
return m.transition().duration(1e3).attr({fill:"grey",class:function(t,e){return"shiftrect "+intStr0[s[e]]},transform:function(t,e){return t>0?"translate("+p+","+(M(e+1)+2.5)+")":"translate("+(C(t)+a)+","+(M(e+1)+2.5)+")"},height:function(t,e){return bt},width:function(t,e){return t>0?C(t)-C(0):C(0)-C(t)}}),g.transition().duration(1e3).attr({class:function(t,e){return"shifttext "+intStr0[s[e]]},transform:function(t,e){return"translate("+n+","+(M(e+1)+bt)+")"}}).style({"text-anchor":"start","font-size":Se}).text(function(t,e){return l[e]}),i=l,ne&&(c=void 0),V=q.selectAll("text.shiftrank").data(o).enter().append("text").attr("y",function(t,e){return M(e+1)+bt}).attr("x",function(t,e){return 0}).style({"text-anchor":"start","font-size":Se}).text(function(t,e){return e+1+"."}),J=q.selectAll("text.shifttype").data(o).enter().append("text").attr("y",function(t,e){return M(e+1)+bt}).attr("x",function(t,e){return n+70}).style({"text-anchor":"middle","font-size":Se}).text(function(t,e){return 0==s[e]?"-":2==s[e]?"-":"+"}),Y=q.selectAll("text.shiftfreq").data(o).enter().append("text").attr("y",function(t,e){return M(e+1)+bt}).attr("x",function(t,e){return n+70+25}).style({"text-anchor":"middle","font-size":Se}).text(function(t,e){return 0==s[e]?"↓":1==s[e]?"↓":"↑"}),K=q.selectAll("text.shiftmag").data(o).enter().append("text").attr("y",function(t,e){return M(e+1)+bt}).attr("x",function(t,e){return n+70+25+25+35}).style({"text-anchor":"end","font-size":Se}).text(function(t,e){return(t/Math.abs(h-f)*100).toFixed(2)+"%"}),Z=q.selectAll("text.header").data(["#","Word","+/-","↑/↓","% Cont.","% Cont."]).enter().append("text").attr({x:function(t,e){return x[e]},y:function(t,e){return M(0)+bt}}).style({"text-anchor":function(t,e){return d[e]},"font-size":function(t,e){return Se}}).text(function(t,e){return t}),q.selectAll(".sumrectR").transition().duration(2e3).attr("x",1e3),q.selectAll(".sumtextR").transition().duration(2e3).attr("x",1e3),q.selectAll(".sumrectL").transition().duration(2e3).attr("x",-1e3),q.selectAll(".sumtextL").transition().duration(2e3).attr("x",-1e3),S.style("stroke-width",0),bottombgrect.attr("y",1e3),T.transition().duration(2e3).attr("y",1e3),L.transition().duration(2e3).attr("x",-1e3),Q.transition().duration(2e3).attr("y",-200),H.transition().duration(1e3).attr({y1:"15",y2:15}),E=d3.behavior.zoom().y(M).scaleExtent([1,1]).on("zoom",t),r}
return{shift:me,ignore:he,setTextBold:Gt,stop:de,istopper:pe,shifter:Ae,selfShifter:ye,setfigure:ct,getfigure:lt,setdata:Xt,plot:Ue,add_help_button:je,show_x_axis:ft,replot:function(){var t=this
if(M.range([wt+2,64]),H.transition().duration(1e3).attr({y1:60,y2:60}),"table"===rt().cached&&(V.remove(),Y.remove(),J.remove(),K.remove(),Z.remove()),et.varval("wordshift"),$t[0].length<1){if(h>=f)var r="happier"
else var r="less happy"
$t=ht(["Reference happiness: "+f.toFixed(2),"Comparison happiness: "+h.toFixed(2),"Why comparison is "+r+" than reference:"],mt-10-Ie,"14px  "+Fe)}else jt&&($t=ht($t,mt-10-Ie,"14px  "+Fe))
D=d3.max(i.slice(0,5).map(function(t){return t.width(Se+"px  "+Fe)}))
C.domain([-Math.abs(o[0]),Math.abs(o[0])]).range([D+10,yt-D-10]),ut&&F.select(".x.axis").call(O),j=17*$t.length+13,e(!0),wt=gt-vt.top-vt.bottom-j,M.range([wt+2,64]),q.attr("transform","translate("+vt.left+","+(vt.top+j)+")").attr("height",wt),S.attr("height",wt-2).style({"stroke-width":.5,stroke:"rgb(20,20,20)"}),topbgrect2.attr("height",j),F.selectAll("text.credit").remove(),U.remove(),U=q.selectAll("text.credit").data(["visualization by","@andyreagan"]).enter().append("text").attr({class:"credit",fill:"#B8B8B8",x:yt-5,y:function(t,e){return wt-15+10*e},"font-size":"8.0px"}).style({"text-anchor":"end"}).text(function(t){return t}),F.selectAll("text.titletext").remove(),X.remove(),X=F.selectAll("text.titletext").data($t).enter().append("text").attr({y:function(t,e){return 17*(e+1)},x:3,class:function(t,e){return"titletext "+intStr[e]}}).style({"font-size":function(t,e){return Yt[e]},"line-height":"1.42857143",color:function(t,e){return Vt[e]},"font-weight":function(t,e){return e<Ot?"bold":"normal"}}).text(function(t,e){return t}),bottombgrect.attr("y",pt-vt.bottom-j)
var n=q.selectAll("rect.shiftrect").data(o),a=q.selectAll("text.shifttext").data(o)
return"none"===$().current||0===$().current.length?(n.transition().duration(1500).attr({fill:function(t,e){return 2==s[e]?"#4C4CFF":3==s[e]?"#FFFF4C":0==s[e]?"#B3B3FF":"#FFFFB3"},class:function(t,e){return"shiftrect "+intStr0[s[e]]},x:0,y:0,transform:function(t,e){return t>0?"translate("+zt+","+M(e+1)+")":"translate("+C(t)+","+M(e+1)+")"},height:function(t,e){return bt},width:function(t,e){return t>0?C(t)-C(0):C(0)-C(t)}}),a.transition().duration(1500).attr({class:function(t,e){return"shifttext "+intStr0[s[e]]},x:0,y:0,transform:function(t,e){return t>0?"translate("+(C(t)+2)+","+(M(e+1)+bt)+")":"translate("+(C(t)-2)+","+(M(e+1)+bt)+")"}}).style({"text-anchor":function(t,e){return o[e]<0?"end":"start"},"font-size":Se}).text(function(t,e){return i[e]})):(n.attr({fill:function(t,e){return 2==s[e]?"#4C4CFF":3==s[e]?"#FFFF4C":0==s[e]?"#B3B3FF":"#FFFFB3"},class:function(t,e){return"shiftrect "+intStr0[s[e]]},x:0,y:0,transform:function(t,e){return t>0?"translate("+zt+","+M(e+1)+")":"translate("+C(t)+","+M(e+1)+")"},height:function(t,e){return bt},width:function(t,e){return t>0?C(t)-C(0):C(0)-C(t)}}),a.attr({class:function(t,e){return"shifttext "+intStr0[s[e]]},x:0,y:0,transform:function(t,e){return t>0?"translate("+(C(t)+2)+","+(M(e+1)+bt)+")":"translate("+(C(t)-2)+","+(M(e+1)+bt)+")"}}).style({"text-anchor":function(t,e){return o[e]<0?"end":"start"},"font-size":Se}).text(function(t,e){return i[e]}),"posup"===$().current?(q.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"})):"negdown"===$().current?(q.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"})):"posdown"===$().current?(q.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"})):"negup"===$().current&&(q.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.zero").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.one").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?zt:C(t))+","+M(e+1)+")"}),q.selectAll("text.shifttext.two").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?C(t)+2:C(t)-2)+","+(M(e+1)+bt)+")"}),q.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+M(e+1)+")"}),q.selectAll("text.shifttext.three").transition().duration(1e3).attr("transform",function(t,e){return"translate("+(t>0?500:-500)+","+(M(e+1)+bt)+")"}))),B=Math.max(Math.abs(u[1]),Math.abs(u[2]),u[0],u[3]),R.domain([-B,B]),P=[u[3],u[0],d3.sum(u)],q.selectAll(".sumrectR").data(P).transition().duration(1500).attr("x",function(t,e){return t>0?zt:R(t)}).attr("width",function(t,e){return t>0?R(t)-zt:zt-R(t)}),q.selectAll(".sumtextR").data([u[3],u[0],d3.sum(u)]).transition().duration(1500).attr("class","sumtextR").style("text-anchor",function(t,e){return t>0?"start":"end"}).attr("x",function(t,e){return R(t)+5*t/Math.abs(t)}),P=[u[1],u[2],u[0]+u[2]],q.selectAll(".sumrectL").data(P).transition().duration(1500).attr("fill",function(t,e){return 0==e?"#FFFFB3":1==e?"#4C4CFF":t>0?"#B3B3FF":"#4C4CFF"}).attr("x",function(t,e){return e<2?R(t):(u[3]+u[1])*(u[0]+u[2])>0?t>0?R(u[3]+u[1]):R(t)-(zt-R(u[3]+u[1])):t>0?zt:R(t)}).attr("width",function(t,e){return t>0?R(t)-zt:zt-R(t)}),q.selectAll(".sumtextL").data([u[1],u[2]]).transition().duration(1500).attr("x",function(t,e){return R(t)-5}),t},table:Ge,cloud:Oe,setText:te,setWidth:Dt,setHeight:Ct,setBgcolor:Zt,splitstring:ht,drawlogo:We,resetbuttontoggle:Pt,plotdist:ve,_reset:Nt,_stoprange:ae,_refF:oe,_compF:se,_lens:ie,_complens:le,_words:ce,_words_en:ue,_refH:qt,_compH:It,_xlabel_text:Lt,_ylabel_text:Et,setTextColors:Jt,setTopTextSizes:_t,_split_top_strings:Ut,_shiftMag:we,_shiftType:be,dualShifter:ke,setFontSizes:He,_fontString:De,_viz_type_use_URL:at,_my_shift_id:Be,_sortedMag:Mt,_sortedType:Rt,_sortedWords:St,_sortedWordsRaw:Tt,get_word_index:Bt}}
var cloudRadians=Math.PI/180
